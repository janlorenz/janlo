<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.33">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2017-02-01">

<title>Submission for Habilitation at Jacobs University – Jan Lorenz</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-ea385d0e468b0dd5ea5bf0780b1290d9.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-44bb8dc7b28dfb45df03172c12b54166.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jan Lorenz</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../publications.html"> 
<span class="menu-text">Publications</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../teaching.html"> 
<span class="menu-text">Teaching</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../scientific-events.html"> 
<span class="menu-text">Scientific Events</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../constructor-labs.html"> 
<span class="menu-text">Constructor Labs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../blog.html"> 
<span class="menu-text">Blog</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#chapter-1-introduction" id="toc-chapter-1-introduction" class="nav-link active" data-scroll-target="#chapter-1-introduction">Chapter 1: Introduction</a></li>
  <li><a href="#chapter-2-opinion-dynamics" id="toc-chapter-2-opinion-dynamics" class="nav-link" data-scroll-target="#chapter-2-opinion-dynamics">Chapter 2: Opinion Dynamics</a></li>
  <li><a href="#chapter-3-societal-growth" id="toc-chapter-3-societal-growth" class="nav-link" data-scroll-target="#chapter-3-societal-growth">Chapter 3: Societal Growth</a></li>
  <li><a href="#chapter-4-the-wisdom-of-the-crowd" id="toc-chapter-4-the-wisdom-of-the-crowd" class="nav-link" data-scroll-target="#chapter-4-the-wisdom-of-the-crowd">Chapter 4: The Wisdom of the Crowd</a></li>
  <li><a href="#source-files" id="toc-source-files" class="nav-link" data-scroll-target="#source-files">Source files</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Submission for Habilitation at Jacobs University</h1>
  <div class="quarto-categories">
    <div class="quarto-category">commenting-own-papers</div>
    <div class="quarto-category">english</div>
  </div>
  </div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 1, 2017</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>I submitted for habilitation in <strong>Computational Social Science</strong> at Jacobs University Bremen with a cumulative habilitation work on</p>
<p><a href="https://drive.google.com/open?id=0B6RUj58gkTakUXJOV3NXXzZqTGs">Systemic Effects in&nbsp;Models of Opinion Dynamics,&nbsp;Societal Growth,&nbsp;and the Wisdom of Crowds</a></p>
<p>It is an 88 page booklet presenting the results of twelve published papers focusing on systemic effects in opinion dynamics and societal growth and on the wisdom of crowd phenomenon in group guesstimation games. Read a short summary with a focus on the new results here.&nbsp;<!--more--></p>
<section id="chapter-1-introduction" class="level2">
<h2 class="anchored" data-anchor-id="chapter-1-introduction">Chapter 1: Introduction</h2>
<p>This chapter outlines what systemic effects are and how they can be studied through agent-based modeling, referring to these two publications:</p>
<ul>
<li><span class="citation" data-cites="Lorenz2012ZurMethodeAgentenbasierten">Lorenz, J. (2012). Zur <span>Methode</span> der agenten-basierten <span>Simulation</span> in der <span>Politikwissenschaft</span> am <span>Beispiel</span> von <span>Meinungsdynamik</span> und <span>Parteienwettstreit</span>. In T. Bräuninger, A. Bächtiger, &amp; S. Shikano (Eds.), <em>Jahrbuch für <span>Handlungs-</span> und <span>Entscheidungstheorie</span>. <span>Band</span> 7: <span>Experiment</span> und <span>Simulation</span></em> (pp. 31–58). VS Verlag für Sozialwissenschaften. <a href="https://doi.org/10.1007/978-3-531-19606-0_2">https://doi.org/10.1007/978-3-531-19606-0_2</a></span></li>
<li><span class="citation" data-cites="GroeberEtAl2014DissonanceMinimizationMicrofoundation">Groeber, P., Lorenz, J., &amp; Schweitzer, F. (2014). Dissonance minimization as a microfoundation of social influence in models of opinion formation. <em>Journal of Mathematical Sociology</em>, <em>38</em>(3), 147–174. <a href="https://doi.org/10.1080/0022250X.2012.724486">https://doi.org/10.1080/0022250X.2012.724486</a></span></li>
</ul>
</section>
<section id="chapter-2-opinion-dynamics" class="level2">
<h2 class="anchored" data-anchor-id="chapter-2-opinion-dynamics">Chapter 2: Opinion Dynamics</h2>
<p>This chapter presents four different models of opinion dynamics, which are the result of theory- or data-driven modeling attempts. The evolving opinion landscapes (= distribution of opinions, represented by histograms) can be plotted on the vertical axis against the core parameter of the model on the horizontal axis. This delivers an <strong>opinion pattern diagram</strong> where the coloring represents the frequency of agents’ opinions in that region of the [core parameter] x opinion space. The opinion landscapes are the one which appear after stabilization. See the four opinion pattern diagrams here:</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/odp1.png" class="img-fluid figure-img"></p>
<figcaption>Opinion pattern diagram for increasing number of links (diffusivity) under a constant ratio of intra-vs-inter-community links. A&nbsp;phase of coexistence of different ideological camps appears with increasing diffusivity. Reference: <span class="citation" data-cites="ShinLorenz2010TippingDiffusivityInformation">Shin, J. K., &amp; Lorenz, J. (2010). Tipping <span>Diffusivity</span> in <span>Information Accumulation Systems</span>: <span>More Links</span>, less <span>Consensus</span>. <em>Journal of Statistical Mechanics: Theory and Experiment</em>, <em>2010</em>(06), P06005. <a href="https://doi.org/10.1088/1742-5468/2010/06/P06005">https://doi.org/10.1088/1742-5468/2010/06/P06005</a></span></figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/odp2.png" class="img-fluid figure-img"></p>
<figcaption>Opinion pattern diagram for the self-reinforcment model for the strength of party attachments (= number of yearly announced party attachments over&nbsp;10 years) with respect to the parameter “Interest in politics”. Reference: <span class="citation" data-cites="MetzLorenz2013BecomeWhoYou">Metz, T., &amp; Lorenz, J. (2013). Become who you are: <span>The</span> homing pattern in partisanship as a self-reinforcing stochastic process. <em>SSRN Preprint</em>. <a href="http://ssrn.com/abstract=2224740">http://ssrn.com/abstract=2224740</a></span></figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/odp3.png" class="img-fluid figure-img"></p>
<figcaption>Opinion pattern diagram for 1-10 star movie rating histograms&nbsp;with respect to movie quality according to a one-parameter fit based on data from <a href="http://imdb.com">IMDb.com</a>. Reference: <span class="citation" data-cites="Lorenz2009UniversalityMovieRating">Lorenz, J. (2009). Universality of movie rating distributions. <em>European Physical Journal B</em>, <em>71</em>, 251–258. <a href="https://doi.org/10.1140/epjb/e2009-00283-3">https://doi.org/10.1140/epjb/e2009-00283-3</a></span></figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="figs/odp4.png" class="img-fluid figure-img"></p>
<figcaption>Opinion pattern diagram for the bounded confidence model with random opinion replacement with respect to the homogeneous bound of confidence <span class="math inline">\(\varepsilon\)</span>. <span class="math inline">\(m=0.1\)</span> means 1 out of 10 agents draw a new opinion at random, while 9 out of ten rely on social interaction under bounded confidence). Notice that the consensus transition (<span class="math inline">\(\varepsilon\approx 0.27\)</span>) is sharp, while the transition between two- and three-cluster regimes (<span class="math inline">\(\varepsilon\approx 0.18\)</span>) is smooth.</figcaption>
</figure>
</div>
<p>Additionally discussed paper:</p>
<ul>
<li><span class="citation" data-cites="Lorenz2017ModelingEvolutionIdeological">Lorenz, J. (2017). Modeling the <span>Evolution</span> of <span>Ideological Landscapes Through Opinion Dynamics</span>. In W. Jager, R. Verbrugge, A. Flache, G. de Roo, L. Hoogduin, &amp; C. Hemelrijk (Eds.), <em>Advances in <span>Social Simulation</span> 2015</em> (pp. 255–266). Springer International Publishing. <a href="https://doi.org/10.1007/978-3-319-47253-9_22">https://doi.org/10.1007/978-3-319-47253-9_22</a></span></li>
</ul>
</section>
<section id="chapter-3-societal-growth" class="level2">
<h2 class="anchored" data-anchor-id="chapter-3-societal-growth">Chapter 3: Societal Growth</h2>
<p>This chapter presents the following three papers and concludes with a short discussion on systemic growth effects.</p>
<ul>
<li><span class="citation" data-cites="KonigEtAl2016InnovationVsImitation">König, M. D., Lorenz, J., &amp; Zilibotti, F. (2016). Innovation vs. Imitation and the evolution of productivity distributions. <em>Theoretical Economics</em>, <em>11</em>(3), 1053–1102. <a href="https://econtheory.org/ojs/index.php/te/article/view/20161053/0">https://econtheory.org/ojs/index.php/te/article/view/20161053/0</a></span></li>
<li><span class="citation" data-cites="LorenzEtAl2013RedistributionSpursGrowth">Lorenz, J., Paetzel, F., &amp; Schweitzer, F. (2013). Redistribution spurs growth by using a portfolio effect on risky human capital. <em>PLoS One</em>, <em>8</em>(2), e54904. <a href="https://doi.org/10.1371/journal.pone.0054904">https://doi.org/10.1371/journal.pone.0054904</a></span></li>
<li><span class="citation" data-cites="LorenzEtAl2017JustDontCall">Lorenz, J., Paetzel, F., &amp; Tepe, M. (2017). Just <span>Don</span>’t <span>Call</span> it a <span>Tax</span>! <span>Framing</span> in an <span>Experiment</span> on <span>Voting</span> and <span>Redistribution</span>. <em>Journal of Experimental Political Science</em>, <em>4</em>(3), 183–194. <a href="https://doi.org/10.1017/XPS.2016.7">https://doi.org/10.1017/XPS.2016.7</a></span></li>
</ul>
</section>
<section id="chapter-4-the-wisdom-of-the-crowd" class="level2">
<h2 class="anchored" data-anchor-id="chapter-4-the-wisdom-of-the-crowd">Chapter 4: The Wisdom of the Crowd</h2>
<p>Besides presenting the results of three papers, this chapter&nbsp;presents a thorough discussion and definition of the wisdom of crowd in group guesstimation tasks (Sec. 4.2). It presents and analyzes three datasets (Sec. 4.1), from which one is the data set from Galton’s famous 1907 paper, while the other twoare collected by my. The later ones were only treated in this blog before. Take a look at the histograms and how different measures of aggregation perform:</p>
<p><img src="figs/woc1.png" class="img-fluid"></p>
<p><img src="figs/woc2.png" class="img-fluid"></p>
<p><img src="figs/woc3.png" class="img-fluid"></p>
<p>The chapter also presents a new concept to relate systematic bias to the expected fraction of “ad hoc” experts in a crowd (Sec. 4.5) and how this transforms to a measure for optimal crowd size.&nbsp;Finally, the concept of diversity sampling is presented (also Sec. 4.5) which shows the doubleedge that it improves the correctness of aggregate estimates for small crowds for the arithmetic mean, while it reduces it for the median. The papers presented are:</p>
<ul>
<li><span class="citation" data-cites="RauhutLorenz2010WisdomCrowdsOne">Rauhut, H., &amp; Lorenz, J. (2010). The wisdom of crowds in one mind: <span>How</span> individuals can simulate the knowledge of diverse societies to reach better decisions. <em>Journal of Mathematical Psychology</em>, <em>55</em>, 191–197. <a href="https://doi.org/10.1016/j.jmp.2010.10.002">https://doi.org/10.1016/j.jmp.2010.10.002</a></span></li>
<li><span class="citation" data-cites="LorenzEtAl2011HowSocialInfluence">Lorenz, J., Rauhut, H., Schweitzer, F., &amp; Helbing, D. (2011). How social influence can undermine the wisdom of crowd effect. <em>Proceedings of the National Academy of Sciences</em>, <em>108</em>(22), 9020–9025. <a href="https://doi.org/10.1073/pnas.1008636108">https://doi.org/10.1073/pnas.1008636108</a></span></li>
</ul>
</section>
<section id="source-files" class="level2">
<h2 class="anchored" data-anchor-id="source-files">Source files</h2>
<p>Source files for the submitted version including R code are at <a href="https://github.com/janlorenz/habil">GitHub: janlorenz/habil</a>.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/www\.janlo\.de");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
  });
  </script>
</div> <!-- /content -->




</body></html>